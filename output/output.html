<html><head><title>Swift Lexer</title><link rel="stylesheet" href="main.css"></head><body><div><p class="COMMENT">/*Copyright (c) 2016, Andrew Walz.
Redistribution and use in source and binary forms, with or without modification,are permitted provided that the following conditions are met:
1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the
documentation and/or other materials provided with the distribution.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS
BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/</p><p class="KEYWORD">

import</p><p class="IDENTIFIER"> UIKit</p><p class="KEYWORD">
import</p><p class="IDENTIFIER"> AVFoundation</p><p class="COMMENT">

// MARK: View Controller Declaration
</p><p class="COMMENT">/// A UIViewController Camera View Subclass
</p><p class="KEYWORD">open</p><p class="KEYWORD"> class</p><p class="IDENTIFIER"> SwiftyCamViewController</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIViewController</p><p class="PUNCTUATION"> {</p><p class="COMMENT">

	// MARK: Enumeration Declaration
</p><p class="COMMENT">	/// Enumeration for Camera Selection
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> enum</p><p class="IDENTIFIER"> CameraSelection</p><p class="PUNCTUATION"> {</p><p class="COMMENT">

		/// Camera on the back of the device
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> rear</p><p class="COMMENT">

		/// Camera on the front of the device
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> front</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Enumeration for video quality of the capture session. Corresponds to a AVCaptureSessionPreset
</p><p class="KEYWORD">
	public</p><p class="KEYWORD"> enum</p><p class="IDENTIFIER"> VideoQuality</p><p class="PUNCTUATION"> {</p><p class="COMMENT">

		/// AVCaptureSessionPresetHigh
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> high</p><p class="COMMENT">

		/// AVCaptureSessionPresetMedium
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> medium</p><p class="COMMENT">

		/// AVCaptureSessionPresetLow
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> low</p><p class="COMMENT">

		/// AVCaptureSessionPreset352x288
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> resolution352x288</p><p class="COMMENT">

		/// AVCaptureSessionPreset640x480
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> resolution640x480</p><p class="COMMENT">

		/// AVCaptureSessionPreset1280x720
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> resolution1280x720</p><p class="COMMENT">

		/// AVCaptureSessionPreset1920x1080
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> resolution1920x1080</p><p class="COMMENT">

		/// AVCaptureSessionPreset3840x2160
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> resolution3840x2160</p><p class="COMMENT">

		/// AVCaptureSessionPresetiFrame960x540
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> iframe960x540</p><p class="COMMENT">

		/// AVCaptureSessionPresetiFrame1280x720
</p><p class="KEYWORD">		case</p><p class="IDENTIFIER"> iframe1280x720</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/**
	Result from the AVCaptureSession Setup
	- success: success
	- notAuthorized: User denied access to Camera of Microphone
	- configurationFailed: Unknown error
	*/</p><p class="KEYWORD">

	fileprivate</p><p class="KEYWORD"> enum</p><p class="IDENTIFIER"> SessionSetupResult</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		case</p><p class="IDENTIFIER"> success</p><p class="KEYWORD">
		case</p><p class="IDENTIFIER"> notAuthorized</p><p class="KEYWORD">
		case</p><p class="IDENTIFIER"> configurationFailed</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	// MARK: Public Variable Declarations
</p><p class="COMMENT">	/// Public Camera Delegate for the Custom View Controller Subclass
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> weak</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> cameraDelegate</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> SwiftyCamViewControllerDelegate</p><p class="OPERATOR">?</p><p class="COMMENT">

	/// Maxiumum video duration if SwiftyCamButton is used
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> maximumVideoDuration</p><p class="PUNCTUATION"> :</p><p class="IDENTIFIER"> Double</p><p class="OPERATOR">     =</p><p class="NUMBER"> 0.0</p><p class="COMMENT">

	/// Video capture quality
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> videoQuality</p><p class="PUNCTUATION"> :</p><p class="IDENTIFIER"> VideoQuality</p><p class="OPERATOR">       =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">high</p><p class="COMMENT">

	/// Sets whether flash is enabled for photo and video capture
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> flashEnabled</p><p class="OPERATOR">                      =</p><p class="KEYWORD"> false</p><p class="COMMENT">

	/// Sets whether Pinch to Zoom is enabled for the capture session
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> pinchToZoom</p><p class="OPERATOR">                       =</p><p class="KEYWORD"> true</p><p class="COMMENT">

	/// Sets the maximum zoom scale allowed during gestures gesture
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> maxZoomScale</p><p class="OPERATOR">				         =</p><p class="IDENTIFIER"> CGFloat</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">greatestFiniteMagnitude</p><p class="COMMENT">

	/// Sets whether Tap to Focus and Tap to Adjust Exposure is enabled for the capture session
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> tapToFocus</p><p class="OPERATOR">                        =</p><p class="KEYWORD"> true</p><p class="COMMENT">

	/// Sets whether the capture session should adjust to low light conditions automatically
</p><p class="COMMENT">	///
</p><p class="COMMENT">	/// Only supported on iPhone 5 and 5C
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> lowLightBoost</p><p class="OPERATOR">                     =</p><p class="KEYWORD"> true</p><p class="COMMENT">

	/// Set whether SwiftyCam should allow background audio from other applications
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> allowBackgroundAudio</p><p class="OPERATOR">              =</p><p class="KEYWORD"> true</p><p class="COMMENT">

	/// Sets whether a double tap to switch cameras is supported
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> doubleTapCameraSwitch</p><p class="OPERATOR">            =</p><p class="KEYWORD"> true</p><p class="COMMENT">

    /// Sets whether swipe vertically to zoom is supported
</p><p class="KEYWORD">
    public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> swipeToZoom</p><p class="OPERATOR">                     =</p><p class="KEYWORD"> true</p><p class="COMMENT">

    /// Sets whether swipe vertically gestures should be inverted
</p><p class="KEYWORD">
    public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> swipeToZoomInverted</p><p class="OPERATOR">             =</p><p class="KEYWORD"> false</p><p class="COMMENT">

	/// Set default launch camera
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> defaultCamera</p><p class="OPERATOR">                   =</p><p class="IDENTIFIER"> CameraSelection</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">rear</p><p class="COMMENT">

	/// Sets wether the taken photo or video should be oriented according to the device orientation
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> shouldUseDeviceOrientation</p><p class="OPERATOR">      =</p><p class="KEYWORD"> false</p><p class="COMMENT">

    /// Sets whether or not View Controller supports auto rotation
</p><p class="KEYWORD">
    public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> allowAutoRotate</p><p class="OPERATOR">                =</p><p class="KEYWORD"> false</p><p class="COMMENT">

    /// Specifies the [videoGravity](https://developer.apple.com/reference/avfoundation/avcapturevideopreviewlayer/1386708-videogravity) for the preview layer.
</p><p class="KEYWORD">    public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> videoGravity</p><p class="PUNCTUATION">                   :</p><p class="IDENTIFIER"> SwiftyCamVideoGravity</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">resizeAspect</p><p class="COMMENT">

    /// Sets whether or not video recordings will record audio
</p><p class="COMMENT">    /// Setting to true will prompt user for access to microphone on View Controller launch.
</p><p class="KEYWORD">    public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> audioEnabled</p><p class="OPERATOR">                   =</p><p class="KEYWORD"> true</p><p class="COMMENT">

    /// Public access to Pinch Gesture
</p><p class="KEYWORD">    fileprivate</p><p class="PUNCTUATION">(</p><p class="KEYWORD">set</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> pinchGesture</p><p class="PUNCTUATION">  :</p><p class="IDENTIFIER"> UIPinchGestureRecognizer</p><p class="OPERATOR">!</p><p class="COMMENT">

    /// Public access to Pan Gesture
</p><p class="KEYWORD">    fileprivate</p><p class="PUNCTUATION">(</p><p class="KEYWORD">set</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> panGesture</p><p class="PUNCTUATION">    :</p><p class="IDENTIFIER"> UIPanGestureRecognizer</p><p class="OPERATOR">!</p><p class="COMMENT">


	// MARK: Public Get-only Variable Declarations
</p><p class="COMMENT">	/// Returns true if video is currently being recorded
</p><p class="KEYWORD">	private</p><p class="PUNCTUATION">(</p><p class="KEYWORD">set</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> isVideoRecording</p><p class="OPERATOR">      =</p><p class="KEYWORD"> false</p><p class="COMMENT">

	/// Returns true if the capture session is currently running
</p><p class="KEYWORD">	private</p><p class="PUNCTUATION">(</p><p class="KEYWORD">set</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> isSessionRunning</p><p class="OPERATOR">     =</p><p class="KEYWORD"> false</p><p class="COMMENT">

	/// Returns the CameraSelection corresponding to the currently utilized camera
</p><p class="KEYWORD">	private</p><p class="PUNCTUATION">(</p><p class="KEYWORD">set</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> public</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> currentCamera</p><p class="OPERATOR">        =</p><p class="IDENTIFIER"> CameraSelection</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">rear</p><p class="COMMENT">

	// MARK: Private Constant Declarations
</p><p class="COMMENT">	/// Current Capture Session
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> session</p><p class="OPERATOR">                           =</p><p class="IDENTIFIER"> AVCaptureSession</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="COMMENT">

	/// Serial queue used for setting up session
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> sessionQueue</p><p class="OPERATOR">                 =</p><p class="IDENTIFIER"> DispatchQueue</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">label</p><p class="PUNCTUATION">:</p><p class="LITERAL"> &quot;session queue&quot;</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> attributes</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> [</p><p class="PUNCTUATION">]</p><p class="PUNCTUATION">)</p><p class="COMMENT">

	// MARK: Private Variable Declarations
</p><p class="COMMENT">	/// Variable for storing current zoom scale
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> zoomScale</p><p class="OPERATOR">                    =</p><p class="IDENTIFIER"> CGFloat</p><p class="PUNCTUATION">(</p><p class="NUMBER">1.0</p><p class="PUNCTUATION">)</p><p class="COMMENT">

	/// Variable for storing initial zoom scale before Pinch to Zoom begins
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> beginZoomScale</p><p class="OPERATOR">               =</p><p class="IDENTIFIER"> CGFloat</p><p class="PUNCTUATION">(</p><p class="NUMBER">1.0</p><p class="PUNCTUATION">)</p><p class="COMMENT">

	/// Returns true if the torch (flash) is currently enabled
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> isCameraTorchOn</p><p class="OPERATOR">              =</p><p class="KEYWORD"> false</p><p class="COMMENT">

	/// Variable to store result of capture session setup
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> setupResult</p><p class="OPERATOR">                  =</p><p class="IDENTIFIER"> SessionSetupResult</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">success</p><p class="COMMENT">

	/// BackgroundID variable for video recording
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> backgroundRecordingID</p><p class="PUNCTUATION">        :</p><p class="IDENTIFIER"> UIBackgroundTaskIdentifier</p><p class="OPERATOR">?</p><p class="OPERATOR"> =</p><p class="KEYWORD"> nil</p><p class="COMMENT">

	/// Video Input variable
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> videoDeviceInput</p><p class="PUNCTUATION">             :</p><p class="IDENTIFIER"> AVCaptureDeviceInput</p><p class="OPERATOR">!</p><p class="COMMENT">

	/// Movie File Output variable
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> movieFileOutput</p><p class="PUNCTUATION">              :</p><p class="IDENTIFIER"> AVCaptureMovieFileOutput</p><p class="OPERATOR">?</p><p class="COMMENT">

	/// Photo File Output variable
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> photoFileOutput</p><p class="PUNCTUATION">              :</p><p class="IDENTIFIER"> AVCaptureStillImageOutput</p><p class="OPERATOR">?</p><p class="COMMENT">

	/// Video Device variable
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> videoDevice</p><p class="PUNCTUATION">                  :</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="OPERATOR">?</p><p class="COMMENT">

	/// PreviewView for the capture session
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> previewLayer</p><p class="PUNCTUATION">                 :</p><p class="IDENTIFIER"> PreviewView</p><p class="OPERATOR">!</p><p class="COMMENT">

	/// UIView for front facing flash
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> flashView</p><p class="PUNCTUATION">                    :</p><p class="IDENTIFIER"> UIView</p><p class="OPERATOR">?</p><p class="COMMENT">

    /// Pan Translation
</p><p class="KEYWORD">
    fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> previousPanTranslation</p><p class="PUNCTUATION">       :</p><p class="IDENTIFIER"> CGFloat</p><p class="OPERATOR"> =</p><p class="NUMBER"> 0.0</p><p class="COMMENT">

	/// Last changed orientation
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> deviceOrientation</p><p class="PUNCTUATION">            :</p><p class="IDENTIFIER"> UIDeviceOrientation</p><p class="OPERATOR">?</p><p class="COMMENT">

	/// Disable view autorotation for forced portrait recorindg
</p><p class="KEYWORD">	override</p><p class="KEYWORD"> open</p><p class="KEYWORD"> var</p><p class="IDENTIFIER"> shouldAutorotate</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> Bool</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		return</p><p class="IDENTIFIER"> allowAutoRotate</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	// MARK: ViewDidLoad
</p><p class="COMMENT">	/// ViewDidLoad Implementation
</p><p class="KEYWORD">	override</p><p class="KEYWORD"> open</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> viewDidLoad</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		super</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">viewDidLoad</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
        previewLayer</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> PreviewView</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">frame</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> view</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">frame</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> videoGravity</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> videoGravity</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
        previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">center</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> view</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">center</p><p class="IDENTIFIER">
        view</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addSubview</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">previewLayer</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
        view</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">sendSubview</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">toBack</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> previewLayer</p><p class="PUNCTUATION">)</p><p class="COMMENT">

		// Add Gesture Recognizers
</p><p class="IDENTIFIER">
        addGestureRecognizers</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

		previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> session</p><p class="COMMENT">

		// Test authorization status for Camera and Micophone
</p><p class="KEYWORD">		switch</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">authorizationStatus</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">forMediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVMediaTypeVideo</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">{</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">authorized</p><p class="PUNCTUATION">:</p><p class="COMMENT">

			// already authorized
</p><p class="KEYWORD">			break</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">notDetermined</p><p class="PUNCTUATION">:</p><p class="COMMENT">

			// not yet determined
</p><p class="IDENTIFIER">			sessionQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">suspend</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			AVCaptureDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">requestAccess</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">forMediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVMediaTypeVideo</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> completionHandler</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> [</p><p class="KEYWORD">unowned</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">]</p><p class="IDENTIFIER"> granted</p><p class="KEYWORD"> in</p><p class="KEYWORD">
				if</p><p class="OPERATOR"> !</p><p class="IDENTIFIER">granted</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
					self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">setupResult</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">notAuthorized</p><p class="PUNCTUATION">
				}</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">sessionQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">resume</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
		default</p><p class="PUNCTUATION">:</p><p class="COMMENT">

			// already been asked. Denied access
</p><p class="IDENTIFIER">			setupResult</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">notAuthorized</p><p class="PUNCTUATION">
		}</p><p class="IDENTIFIER">
		sessionQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> [</p><p class="KEYWORD">unowned</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">]</p><p class="KEYWORD"> in</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">configureSession</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

    // MARK: ViewDidLayoutSubviews
</p><p class="COMMENT">
    /// ViewDidLayoutSubviews() Implementation
</p><p class="KEYWORD">    private</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> updatePreviewLayer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">layer</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVCaptureConnection</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> orientation</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVCaptureVideoOrientation</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">

        layer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">videoOrientation</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> orientation</p><p class="IDENTIFIER">

        previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">frame</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">view</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">bounds</p><p class="PUNCTUATION">

    }</p><p class="KEYWORD">

    override</p><p class="KEYWORD"> open</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> viewDidLayoutSubviews</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
        super</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">viewDidLayoutSubviews</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

        if</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> connection</p><p class="OPERATOR"> =</p><p class="KEYWORD">  self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">previewLayer</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">videoPreviewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">connection</p><p class="PUNCTUATION">  {</p><p class="KEYWORD">

            let</p><p class="IDENTIFIER"> currentDevice</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIDevice</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">current</p><p class="KEYWORD">

            let</p><p class="IDENTIFIER"> orientation</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIDeviceOrientation</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> currentDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">orientation</p><p class="KEYWORD">

            let</p><p class="IDENTIFIER"> previewLayerConnection</p><p class="PUNCTUATION"> :</p><p class="IDENTIFIER"> AVCaptureConnection</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> connection</p><p class="KEYWORD">

            if</p><p class="IDENTIFIER"> previewLayerConnection</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isVideoOrientationSupported</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">

                switch</p><p class="PUNCTUATION"> (</p><p class="IDENTIFIER">orientation</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
                case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portrait</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> updatePreviewLayer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">layer</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> previewLayerConnection</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> orientation</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portrait</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

                    break</p><p class="KEYWORD">

                case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeRight</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> updatePreviewLayer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">layer</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> previewLayerConnection</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> orientation</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeLeft</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

                    break</p><p class="KEYWORD">

                case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeLeft</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> updatePreviewLayer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">layer</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> previewLayerConnection</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> orientation</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeRight</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

                    break</p><p class="KEYWORD">

                case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portraitUpsideDown</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> updatePreviewLayer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">layer</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> previewLayerConnection</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> orientation</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portraitUpsideDown</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

                    break</p><p class="KEYWORD">

                default</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> updatePreviewLayer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">layer</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> previewLayerConnection</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> orientation</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portrait</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

                    break</p><p class="PUNCTUATION">
                }</p><p class="PUNCTUATION">
            }</p><p class="PUNCTUATION">
        }</p><p class="PUNCTUATION">
    }</p><p class="COMMENT">
	// MARK: ViewDidAppear
</p><p class="COMMENT">	/// ViewDidAppear(_ animated:) Implementation
</p><p class="KEYWORD">
	override</p><p class="KEYWORD"> open</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> viewDidAppear</p><p class="PUNCTUATION">(</p><p class="KEYWORD">_</p><p class="IDENTIFIER"> animated</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> Bool</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		super</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">viewDidAppear</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">animated</p><p class="PUNCTUATION">)</p><p class="COMMENT">

		// Subscribe to device rotation notifications
</p><p class="KEYWORD">		if</p><p class="IDENTIFIER"> shouldUseDeviceOrientation</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			subscribeToDeviceOrientationChangeNotifications</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="COMMENT">

		// Set background audio preference
</p><p class="IDENTIFIER">		setBackgroundAudioPreference</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

		sessionQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			switch</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">setupResult</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">success</p><p class="PUNCTUATION">:</p><p class="COMMENT">
				// Begin Session
</p><p class="KEYWORD">				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">startRunning</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isSessionRunning</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isRunning</p><p class="COMMENT">

                // Preview layer video orientation can be set only after the connection is created
</p><p class="IDENTIFIER">                DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
                    self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">videoPreviewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">connection</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">videoOrientation</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">getPreviewLayerOrientation</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
                }</p><p class="KEYWORD">

			case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">notAuthorized</p><p class="PUNCTUATION">:</p><p class="COMMENT">
				// Prompt to App Settings
</p><p class="KEYWORD">				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">promptToAppSettings</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
			case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">configurationFailed</p><p class="PUNCTUATION">:</p><p class="COMMENT">
				// Unknown Error
</p><p class="IDENTIFIER">				DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">execute</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> [</p><p class="KEYWORD">unowned</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">]</p><p class="KEYWORD"> in</p><p class="KEYWORD">
					let</p><p class="IDENTIFIER"> message</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> NSLocalizedString</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;Unable to capture media&quot;</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> comment</p><p class="PUNCTUATION">:</p><p class="LITERAL"> &quot;Alert message when something goes wrong during capture session configuration&quot;</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
					let</p><p class="IDENTIFIER"> alertController</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIAlertController</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">title</p><p class="PUNCTUATION">:</p><p class="LITERAL"> &quot;AVCam&quot;</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> message</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> message</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> preferredStyle</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">alert</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
					alertController</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addAction</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">UIAlertAction</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">title</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> NSLocalizedString</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;OK&quot;</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> comment</p><p class="PUNCTUATION">:</p><p class="LITERAL"> &quot;Alert OK button&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> style</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">cancel</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> handler</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
					self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">present</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">alertController</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> animated</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> true</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> completion</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	// MARK: ViewDidDisappear
</p><p class="COMMENT">	/// ViewDidDisappear(_ animated:) Implementation
</p><p class="KEYWORD">
	override</p><p class="KEYWORD"> open</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> viewDidDisappear</p><p class="PUNCTUATION">(</p><p class="KEYWORD">_</p><p class="IDENTIFIER"> animated</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> Bool</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		super</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">viewDidDisappear</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">animated</p><p class="PUNCTUATION">)</p><p class="COMMENT">

		// If session is running, stop the session
</p><p class="KEYWORD">		if</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isSessionRunning</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">stopRunning</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isSessionRunning</p><p class="OPERATOR"> =</p><p class="KEYWORD"> false</p><p class="PUNCTUATION">
		}</p><p class="COMMENT">

		//Disble flash if it is currently enabled
</p><p class="IDENTIFIER">		disableFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="COMMENT">

		// Unsubscribe from device rotation notifications
</p><p class="KEYWORD">		if</p><p class="IDENTIFIER"> shouldUseDeviceOrientation</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			unsubscribeFromDeviceOrientationChangeNotifications</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	// MARK: Public Functions
</p><p class="COMMENT">	/**
	Capture photo from current session
	UIImage will be returned with the SwiftyCamViewControllerDelegate function SwiftyCamDidTakePhoto(photo:)
	*/</p><p class="KEYWORD">

	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> takePhoto</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">

		guard</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> device</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> videoDevice</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

		if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">hasFlash</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="OPERATOR"> &amp;&amp;</p><p class="IDENTIFIER"> flashEnabled</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="COMMENT"> /* TODO: Add Support for Retina Flash and add front flash */</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			changeFlashSettings</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">device</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> mode</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">on</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			capturePhotoAsyncronously</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">completionHandler</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> (</p><p class="KEYWORD">_</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> in</p><p class="PUNCTUATION"> }</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">

		}</p><p class="KEYWORD"> else</p><p class="KEYWORD"> if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">hasFlash</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> false</p><p class="OPERATOR"> &amp;&amp;</p><p class="IDENTIFIER"> flashEnabled</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="OPERATOR"> &amp;&amp;</p><p class="IDENTIFIER"> currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			flashView</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIView</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">frame</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> view</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">frame</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">alpha</p><p class="OPERATOR"> =</p><p class="NUMBER"> 0.0</p><p class="IDENTIFIER">
			flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">backgroundColor</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIColor</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">white</p><p class="IDENTIFIER">
			previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addSubview</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">flashView</p><p class="OPERATOR">!</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

			UIView</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">animate</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withDuration</p><p class="PUNCTUATION">:</p><p class="NUMBER"> 0.1</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> delay</p><p class="PUNCTUATION">:</p><p class="NUMBER"> 0.0</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> options</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">curveEaseInOut</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> animations</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">alpha</p><p class="OPERATOR"> =</p><p class="NUMBER"> 1.0</p><p class="PUNCTUATION">

			}</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> completion</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> (</p><p class="KEYWORD">_</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> in</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">capturePhotoAsyncronously</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">completionHandler</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> (</p><p class="IDENTIFIER">success</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> in</p><p class="IDENTIFIER">
					UIView</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">animate</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withDuration</p><p class="PUNCTUATION">:</p><p class="NUMBER"> 0.1</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> delay</p><p class="PUNCTUATION">:</p><p class="NUMBER"> 0.0</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> options</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">curveEaseInOut</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> animations</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
						self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">alpha</p><p class="OPERATOR"> =</p><p class="NUMBER"> 0.0</p><p class="PUNCTUATION">
					}</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> completion</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> (</p><p class="KEYWORD">_</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> in</p><p class="KEYWORD">
						self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">removeFromSuperview</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
					}</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isFlashActive</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				changeFlashSettings</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">device</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> mode</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">off</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="IDENTIFIER">
			capturePhotoAsyncronously</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">completionHandler</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> (</p><p class="KEYWORD">_</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> in</p><p class="PUNCTUATION"> }</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/**
	Begin recording video of current session
	SwiftyCamViewControllerDelegate function SwiftyCamDidBeginRecordingVideo() will be called
	*/</p><p class="KEYWORD">

	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> startVideoRecording</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> movieFileOutput</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">movieFileOutput</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

		if</p><p class="IDENTIFIER"> currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="OPERATOR"> &amp;&amp;</p><p class="IDENTIFIER"> flashEnabled</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			enableFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

		if</p><p class="IDENTIFIER"> currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="OPERATOR"> &amp;&amp;</p><p class="IDENTIFIER"> flashEnabled</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			flashView</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIView</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">frame</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> view</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">frame</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">backgroundColor</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIColor</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">white</p><p class="IDENTIFIER">
			flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">alpha</p><p class="OPERATOR"> =</p><p class="NUMBER"> 0.85</p><p class="IDENTIFIER">
			previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addSubview</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">flashView</p><p class="OPERATOR">!</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="IDENTIFIER">

		sessionQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> [</p><p class="KEYWORD">unowned</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">]</p><p class="KEYWORD"> in</p><p class="KEYWORD">
			if</p><p class="OPERATOR"> !</p><p class="IDENTIFIER">movieFileOutput</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isRecording</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				if</p><p class="IDENTIFIER"> UIDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">current</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isMultitaskingSupported</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
					self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">backgroundRecordingID</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIApplication</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">shared</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">beginBackgroundTask</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">expirationHandler</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="COMMENT">

				// Update the orientation on the movie file output video connection before starting recording.
</p><p class="KEYWORD">				let</p><p class="IDENTIFIER"> movieFileOutputConnection</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">movieFileOutput</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">connection</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withMediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVMediaTypeVideo</p><p class="PUNCTUATION">)</p><p class="COMMENT">


				//flip video output if front facing camera is selected
</p><p class="KEYWORD">				if</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					movieFileOutputConnection</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">isVideoMirrored</p><p class="OPERATOR"> =</p><p class="KEYWORD"> true</p><p class="PUNCTUATION">
				}</p><p class="IDENTIFIER">

				movieFileOutputConnection</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">videoOrientation</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">getVideoOrientation</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="COMMENT">

				// Start recording to a temporary file.
</p><p class="KEYWORD">				let</p><p class="IDENTIFIER"> outputFileName</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UUID</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">uuidString</p><p class="KEYWORD">
				let</p><p class="IDENTIFIER"> outputFilePath</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> (</p><p class="IDENTIFIER">NSTemporaryDirectory</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> as</p><p class="IDENTIFIER"> NSString</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">appendingPathComponent</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">outputFileName</p><p class="KEYWORD"> as</p><p class="IDENTIFIER"> NSString</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">appendingPathExtension</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;mov&quot;</p><p class="PUNCTUATION">)</p><p class="OPERATOR">!</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
				movieFileOutput</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">startRecording</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">toOutputFileURL</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> URL</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">fileURLWithPath</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> outputFilePath</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> recordingDelegate</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isVideoRecording</p><p class="OPERATOR"> =</p><p class="KEYWORD"> true</p><p class="IDENTIFIER">
				DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
					self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didBeginRecordingVideo</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">currentCamera</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD">
			else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				movieFileOutput</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">stopRecording</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/**
	Stop video recording video of current session
	SwiftyCamViewControllerDelegate function SwiftyCamDidFinishRecordingVideo() will be called
	When video has finished processing, the URL to the video location will be returned by SwiftyCamDidFinishProcessingVideoAt(url:)
	*/</p><p class="KEYWORD">

	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> stopVideoRecording</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">movieFileOutput</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">isRecording</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isVideoRecording</p><p class="OPERATOR"> =</p><p class="KEYWORD"> false</p><p class="IDENTIFIER">
			movieFileOutput</p><p class="OPERATOR">!.</p><p class="IDENTIFIER">stopRecording</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			disableFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

			if</p><p class="IDENTIFIER"> currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="OPERATOR"> &amp;&amp;</p><p class="IDENTIFIER"> flashEnabled</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="OPERATOR"> &amp;&amp;</p><p class="IDENTIFIER"> flashView</p><p class="OPERATOR"> !=</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				UIView</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">animate</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withDuration</p><p class="PUNCTUATION">:</p><p class="NUMBER"> 0.1</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> delay</p><p class="PUNCTUATION">:</p><p class="NUMBER"> 0.0</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> options</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">curveEaseInOut</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> animations</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
					self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">alpha</p><p class="OPERATOR"> =</p><p class="NUMBER"> 0.0</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> completion</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> (</p><p class="KEYWORD">_</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> in</p><p class="KEYWORD">
					self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">flashView</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">removeFromSuperview</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="IDENTIFIER">
			DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didFinishRecordingVideo</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">currentCamera</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/**
	Switch between front and rear camera
	SwiftyCamViewControllerDelegate function SwiftyCamDidSwitchCameras(camera:  will be return the current camera selection
	*/</p><p class="KEYWORD">


	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> switchCamera</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="IDENTIFIER"> isVideoRecording</p><p class="OPERATOR"> !=</p><p class="KEYWORD"> true</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
			//TODO: Look into switching camera during video recording
</p><p class="IDENTIFIER">			print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Switching between cameras while recording video is not supported&quot;</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

        guard</p><p class="IDENTIFIER"> session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isRunning</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
            return</p><p class="PUNCTUATION">
        }</p><p class="KEYWORD">

		switch</p><p class="IDENTIFIER"> currentCamera</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER">
			currentCamera</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER">
			currentCamera</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="PUNCTUATION">
		}</p><p class="IDENTIFIER">

		session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">stopRunning</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

		sessionQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> [</p><p class="KEYWORD">unowned</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">]</p><p class="KEYWORD"> in</p><p class="COMMENT">

			// remove and re-add inputs and outputs
</p><p class="KEYWORD">			for</p><p class="IDENTIFIER"> input</p><p class="KEYWORD"> in</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">inputs</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">removeInput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">input</p><p class="KEYWORD"> as</p><p class="OPERATOR">!</p><p class="IDENTIFIER"> AVCaptureInput</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD">

			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addInputs</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didSwitchCameras</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">currentCamera</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD">

			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">startRunning</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="COMMENT">

		// If flash is enabled, disable it as the torch is needed for front facing camera
</p><p class="IDENTIFIER">		disableFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	// MARK: Private Functions
</p><p class="COMMENT">	/// Configure session, add inputs and outputs
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> configureSession</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="IDENTIFIER"> setupResult</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">success</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION">
		}</p><p class="COMMENT">

		// Set default camera
</p><p class="IDENTIFIER">		currentCamera</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> defaultCamera</p><p class="COMMENT">

		// begin configuring session
</p><p class="IDENTIFIER">		session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">beginConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		configureVideoPreset</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		addVideoInput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		addAudioInput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		configureVideoOutput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		configurePhotoOutput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

		session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">commitConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Add inputs after changing camera()
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> addInputs</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
		session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">beginConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		configureVideoPreset</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		addVideoInput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		addAudioInput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">commitConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">


	// Front facing camera will always be set to VideoQuality.high
</p><p class="COMMENT">	// If set video quality is not supported, videoQuality variable will be set to VideoQuality.high
</p><p class="COMMENT">	/// Configure image quality preset
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> configureVideoPreset</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="IDENTIFIER"> currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">sessionPreset</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> videoInputPresetFromVideoQuality</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">quality</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">high</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			if</p><p class="IDENTIFIER"> session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">canSetSessionPreset</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">videoInputPresetFromVideoQuality</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">quality</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> videoQuality</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">sessionPreset</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> videoInputPresetFromVideoQuality</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">quality</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> videoQuality</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">sessionPreset</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> videoInputPresetFromVideoQuality</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">quality</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">high</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Add Video Inputs
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> addVideoInput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		switch</p><p class="IDENTIFIER"> currentCamera</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER">
			videoDevice</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> SwiftyCamViewController</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">deviceWithMediaType</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">AVMediaTypeVideo</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> preferringPosition</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">front</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER">
			videoDevice</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> SwiftyCamViewController</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">deviceWithMediaType</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">AVMediaTypeVideo</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> preferringPosition</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">back</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

		if</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> device</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> videoDevice</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				try</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">lockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
				if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isFocusModeSupported</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">continuousAutoFocus</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">focusMode</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">continuousAutoFocus</p><p class="KEYWORD">
					if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isSmoothAutoFocusSupported</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
						device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isSmoothAutoFocusEnabled</p><p class="OPERATOR"> =</p><p class="KEYWORD"> true</p><p class="PUNCTUATION">
					}</p><p class="PUNCTUATION">
				}</p><p class="KEYWORD">

				if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isExposureModeSupported</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">continuousAutoExposure</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">exposureMode</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">continuousAutoExposure</p><p class="PUNCTUATION">
				}</p><p class="KEYWORD">

				if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isWhiteBalanceModeSupported</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">continuousAutoWhiteBalance</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">whiteBalanceMode</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">continuousAutoWhiteBalance</p><p class="PUNCTUATION">
				}</p><p class="KEYWORD">

				if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isLowLightBoostSupported</p><p class="OPERATOR"> &amp;&amp;</p><p class="IDENTIFIER"> lowLightBoost</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">automaticallyEnablesLowLightBoostWhenAvailable</p><p class="OPERATOR"> =</p><p class="KEYWORD"> true</p><p class="PUNCTUATION">
				}</p><p class="IDENTIFIER">

				device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">unlockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD"> catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Error locking configuration&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

		do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			let</p><p class="IDENTIFIER"> videoDeviceInput</p><p class="OPERATOR"> =</p><p class="KEYWORD"> try</p><p class="IDENTIFIER"> AVCaptureDeviceInput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">device</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> videoDevice</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

			if</p><p class="IDENTIFIER"> session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">canAddInput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">videoDeviceInput</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addInput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">videoDeviceInput</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">videoDeviceInput</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> videoDeviceInput</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Could not add video device input to the session&quot;</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
				print</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">canSetSessionPreset</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">videoInputPresetFromVideoQuality</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">quality</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> videoQuality</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
				setupResult</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">configurationFailed</p><p class="IDENTIFIER">
				session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">commitConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
				return</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD"> catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Could not create video device input: \(error)&quot;</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			setupResult</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">configurationFailed</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Add Audio Inputs
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> addAudioInput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
        guard</p><p class="IDENTIFIER"> audioEnabled</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
            return</p><p class="PUNCTUATION">
        }</p><p class="KEYWORD">
		do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			let</p><p class="IDENTIFIER"> audioDevice</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">defaultDevice</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withMediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVMediaTypeAudio</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
			let</p><p class="IDENTIFIER"> audioDeviceInput</p><p class="OPERATOR"> =</p><p class="KEYWORD"> try</p><p class="IDENTIFIER"> AVCaptureDeviceInput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">device</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> audioDevice</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

			if</p><p class="IDENTIFIER"> session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">canAddInput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">audioDeviceInput</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addInput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">audioDeviceInput</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD">
			else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Could not add audio device input to the session&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">
		catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Could not create audio device input: \(error)&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Configure Movie Output
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> configureVideoOutput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		let</p><p class="IDENTIFIER"> movieFileOutput</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureMovieFileOutput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

		if</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">canAddOutput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">movieFileOutput</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addOutput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">movieFileOutput</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
			if</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> connection</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> movieFileOutput</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">connection</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withMediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVMediaTypeVideo</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				if</p><p class="IDENTIFIER"> connection</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isVideoStabilizationSupported</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					connection</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">preferredVideoStabilizationMode</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">auto</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">movieFileOutput</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> movieFileOutput</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Configure Photo Output
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> configurePhotoOutput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		let</p><p class="IDENTIFIER"> photoFileOutput</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureStillImageOutput</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

		if</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">canAddOutput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">photoFileOutput</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			photoFileOutput</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">outputSettings</p><p class="OPERATOR">  =</p><p class="PUNCTUATION"> [</p><p class="IDENTIFIER">AVVideoCodecKey</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVVideoCodecJPEG</p><p class="PUNCTUATION">]</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addOutput</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">photoFileOutput</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">photoFileOutput</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> photoFileOutput</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Orientation management
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> subscribeToDeviceOrientationChangeNotifications</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">deviceOrientation</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">current</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">orientation</p><p class="IDENTIFIER">
		NotificationCenter</p><p class="PUNCTUATION">.</p><p class="KEYWORD">default</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addObserver</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> selector</p><p class="PUNCTUATION">:</p><p class="DIRECTIVE"> #selector</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">deviceDidRotate</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> name</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> NSNotification</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">Name</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">UIDeviceOrientationDidChange</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> object</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="KEYWORD">

	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> unsubscribeFromDeviceOrientationChangeNotifications</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
		NotificationCenter</p><p class="PUNCTUATION">.</p><p class="KEYWORD">default</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">removeObserver</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> name</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> NSNotification</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">Name</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">UIDeviceOrientationDidChange</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> object</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
		self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">deviceOrientation</p><p class="OPERATOR"> =</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">
	}</p><p class="PUNCTUATION">

	@</p><p class="IDENTIFIER">objc</p><p class="KEYWORD"> fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> deviceDidRotate</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="OPERATOR"> !</p><p class="IDENTIFIER">UIDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">current</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">orientation</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isFlat</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">deviceOrientation</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">current</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">orientation</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="KEYWORD">

    fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> getPreviewLayerOrientation</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="IDENTIFIER"> AVCaptureVideoOrientation</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
        // Depends on layout orientation, not device orientation
</p><p class="KEYWORD">        switch</p><p class="IDENTIFIER"> UIApplication</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">shared</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">statusBarOrientation</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
        case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portrait</p><p class="PUNCTUATION">,</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">unknown</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
            return</p><p class="IDENTIFIER"> AVCaptureVideoOrientation</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">portrait</p><p class="KEYWORD">
        case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeLeft</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
            return</p><p class="IDENTIFIER"> AVCaptureVideoOrientation</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">landscapeLeft</p><p class="KEYWORD">
        case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeRight</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
            return</p><p class="IDENTIFIER"> AVCaptureVideoOrientation</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">landscapeRight</p><p class="KEYWORD">
        case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portraitUpsideDown</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
            return</p><p class="IDENTIFIER"> AVCaptureVideoOrientation</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">portraitUpsideDown</p><p class="PUNCTUATION">
        }</p><p class="PUNCTUATION">
    }</p><p class="KEYWORD">

	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> getVideoOrientation</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="IDENTIFIER"> AVCaptureVideoOrientation</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="IDENTIFIER"> shouldUseDeviceOrientation</p><p class="PUNCTUATION">,</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> deviceOrientation</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">deviceOrientation</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> previewLayer</p><p class="OPERATOR">!.</p><p class="IDENTIFIER">videoPreviewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">connection</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">videoOrientation</p><p class="PUNCTUATION"> }</p><p class="KEYWORD">

		switch</p><p class="IDENTIFIER"> deviceOrientation</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeLeft</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeRight</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeRight</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeLeft</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portraitUpsideDown</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portraitUpsideDown</p><p class="KEYWORD">
		default</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portrait</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="KEYWORD">

	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> getImageOrientation</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">forCamera</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> CameraSelection</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="IDENTIFIER"> UIImageOrientation</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="IDENTIFIER"> shouldUseDeviceOrientation</p><p class="PUNCTUATION">,</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> deviceOrientation</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">deviceOrientation</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> forCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="OPERATOR"> ?</p><p class="PUNCTUATION"> .</p><p class="KEYWORD">right</p><p class="PUNCTUATION"> :</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">leftMirrored</p><p class="PUNCTUATION"> }</p><p class="KEYWORD">

		switch</p><p class="IDENTIFIER"> deviceOrientation</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeLeft</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			return</p><p class="IDENTIFIER"> forCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="OPERATOR"> ?</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">up</p><p class="PUNCTUATION"> :</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">downMirrored</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">landscapeRight</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			return</p><p class="IDENTIFIER"> forCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="OPERATOR"> ?</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">down</p><p class="PUNCTUATION"> :</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">upMirrored</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">portraitUpsideDown</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			return</p><p class="IDENTIFIER"> forCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="OPERATOR"> ?</p><p class="PUNCTUATION"> .</p><p class="KEYWORD">left</p><p class="PUNCTUATION"> :</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rightMirrored</p><p class="KEYWORD">
		default</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			return</p><p class="IDENTIFIER"> forCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="OPERATOR"> ?</p><p class="PUNCTUATION"> .</p><p class="KEYWORD">right</p><p class="PUNCTUATION"> :</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">leftMirrored</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/**
	Returns a UIImage from Image Data.
	- Parameter imageData: Image Data returned from capturing photo from the capture session.
	- Returns: UIImage from the image data, adjusted for proper orientation.
	*/</p><p class="KEYWORD">

	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> processPhoto</p><p class="PUNCTUATION">(</p><p class="KEYWORD">_</p><p class="IDENTIFIER"> imageData</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> Data</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="IDENTIFIER"> UIImage</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		let</p><p class="IDENTIFIER"> dataProvider</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> CGDataProvider</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">data</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> imageData</p><p class="KEYWORD"> as</p><p class="IDENTIFIER"> CFData</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
		let</p><p class="IDENTIFIER"> cgImageRef</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> CGImage</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">jpegDataProviderSource</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> dataProvider</p><p class="OPERATOR">!</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> decode</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> shouldInterpolate</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> true</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> intent</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> CGColorRenderingIntent</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">defaultIntent</p><p class="PUNCTUATION">)</p><p class="COMMENT">

		// Set proper orientation for photo
</p><p class="COMMENT">		// If camera is currently set to front camera, flip image
</p><p class="KEYWORD">		let</p><p class="IDENTIFIER"> image</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIImage</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">cgImage</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> cgImageRef</p><p class="OPERATOR">!</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> scale</p><p class="PUNCTUATION">:</p><p class="NUMBER"> 1.0</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> orientation</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">getImageOrientation</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">forCamera</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">currentCamera</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

		return</p><p class="IDENTIFIER"> image</p><p class="PUNCTUATION">
	}</p><p class="KEYWORD">

	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> capturePhotoAsyncronously</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">completionHandler</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> @</p><p class="IDENTIFIER">escaping</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">Bool</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="PUNCTUATION"> (</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> videoConnection</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> photoFileOutput</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">connection</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withMediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVMediaTypeVideo</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">

			photoFileOutput</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">captureStillImageAsynchronously</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">from</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> videoConnection</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> completionHandler</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">sampleBuffer</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> error</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> in</p><p class="KEYWORD">
				if</p><p class="PUNCTUATION"> (</p><p class="IDENTIFIER">sampleBuffer</p><p class="OPERATOR"> !=</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
					let</p><p class="IDENTIFIER"> imageData</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureStillImageOutput</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">jpegStillImageNSDataRepresentation</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">sampleBuffer</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
					let</p><p class="IDENTIFIER"> image</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">processPhoto</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">imageData</p><p class="OPERATOR">!</p><p class="PUNCTUATION">)</p><p class="COMMENT">

					// Call delegate and return new image
</p><p class="IDENTIFIER">					DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
						self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didTake</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> image</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
					}</p><p class="IDENTIFIER">
					completionHandler</p><p class="PUNCTUATION">(</p><p class="KEYWORD">true</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					completionHandler</p><p class="PUNCTUATION">(</p><p class="KEYWORD">false</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			completionHandler</p><p class="PUNCTUATION">(</p><p class="KEYWORD">false</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Handle Denied App Privacy Settings
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> promptToAppSettings</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
		// prompt User with UIAlertView
</p><p class="IDENTIFIER">		DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">execute</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="PUNCTUATION"> [</p><p class="KEYWORD">unowned</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">]</p><p class="KEYWORD"> in</p><p class="KEYWORD">
			let</p><p class="IDENTIFIER"> message</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> NSLocalizedString</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;AVCam doesn&#x27;t have permission to use the camera, please change privacy settings&quot;</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> comment</p><p class="PUNCTUATION">:</p><p class="LITERAL"> &quot;Alert message when the user has denied access to the camera&quot;</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
			let</p><p class="IDENTIFIER"> alertController</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIAlertController</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">title</p><p class="PUNCTUATION">:</p><p class="LITERAL"> &quot;AVCam&quot;</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> message</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> message</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> preferredStyle</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">alert</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			alertController</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addAction</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">UIAlertAction</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">title</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> NSLocalizedString</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;OK&quot;</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> comment</p><p class="PUNCTUATION">:</p><p class="LITERAL"> &quot;Alert OK button&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> style</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">cancel</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> handler</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			alertController</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addAction</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">UIAlertAction</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">title</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> NSLocalizedString</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;Settings&quot;</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> comment</p><p class="PUNCTUATION">:</p><p class="LITERAL"> &quot;Alert button to open Settings&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> style</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> .</p><p class="KEYWORD">default</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> handler</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER"> action</p><p class="KEYWORD"> in</p><p class="KEYWORD">
				if</p><p class="DIRECTIVE"> #available</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">iOS</p><p class="NUMBER"> 10.0</p><p class="PUNCTUATION">,</p><p class="OPERATOR"> *</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					UIApplication</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">shared</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">openURL</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">URL</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">string</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIApplicationOpenSettingsURLString</p><p class="PUNCTUATION">)</p><p class="OPERATOR">!</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
					if</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> appSettings</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> URL</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">string</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIApplicationOpenSettingsURLString</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
						UIApplication</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">shared</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">openURL</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">appSettings</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
					}</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
			self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">present</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">alertController</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> animated</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> true</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> completion</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/**
	Returns an AVCapturePreset from VideoQuality Enumeration
	- Parameter quality: ViewQuality enum
	- Returns: String representing a AVCapturePreset
	*/</p><p class="KEYWORD">

	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> videoInputPresetFromVideoQuality</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">quality</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> VideoQuality</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="IDENTIFIER"> String</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		switch</p><p class="IDENTIFIER"> quality</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">high</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPresetHigh</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">medium</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPresetMedium</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">low</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPresetLow</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">resolution352x288</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPreset352x288</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">resolution640x480</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPreset640x480</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">resolution1280x720</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPreset1280x720</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">resolution1920x1080</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPreset1920x1080</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">iframe960x540</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPresetiFrame960x540</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">iframe1280x720</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> return</p><p class="IDENTIFIER"> AVCaptureSessionPresetiFrame1280x720</p><p class="KEYWORD">
		case</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">resolution3840x2160</p><p class="PUNCTUATION">:</p><p class="KEYWORD">
			if</p><p class="DIRECTIVE"> #available</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">iOS</p><p class="NUMBER"> 9.0</p><p class="PUNCTUATION">,</p><p class="OPERATOR"> *</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				return</p><p class="IDENTIFIER"> AVCaptureSessionPreset3840x2160</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD">
			else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Resolution 3840x2160 not supported&quot;</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
				return</p><p class="IDENTIFIER"> AVCaptureSessionPresetHigh</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Get Devices
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> class</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> deviceWithMediaType</p><p class="PUNCTUATION">(</p><p class="KEYWORD">_</p><p class="IDENTIFIER"> mediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> String</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> preferringPosition</p><p class="IDENTIFIER"> position</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVCaptureDevicePosition</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="OPERATOR">?</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> devices</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">devices</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withMediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> mediaType</p><p class="PUNCTUATION">)</p><p class="KEYWORD"> as</p><p class="OPERATOR">?</p><p class="PUNCTUATION"> [</p><p class="IDENTIFIER">AVCaptureDevice</p><p class="PUNCTUATION">]</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			return</p><p class="IDENTIFIER"> devices</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">filter</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">{</p><p class="IDENTIFIER"> $0</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">position</p><p class="OPERATOR"> ==</p><p class="IDENTIFIER"> position</p><p class="PUNCTUATION"> }</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">first</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">
		return</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Enable or disable flash for photo
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> changeFlashSettings</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">device</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> mode</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVCaptureFlashMode</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			try</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">lockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
			device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">flashMode</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> mode</p><p class="IDENTIFIER">
			device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">unlockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD"> catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: \(error)&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Enable flash
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> enableFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isCameraTorchOn</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> false</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			toggleFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Disable flash
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> disableFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isCameraTorchOn</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			toggleFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Toggles between enabling and disabling flash
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> toggleFlash</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
			// Flash is not supported for front facing camera
</p><p class="KEYWORD">			return</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

		let</p><p class="IDENTIFIER"> device</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">defaultDevice</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">withMediaType</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVMediaTypeVideo</p><p class="PUNCTUATION">)</p><p class="COMMENT">
		// Check if device has a flash
</p><p class="KEYWORD">		if</p><p class="PUNCTUATION"> (</p><p class="IDENTIFIER">device</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">hasTorch</p><p class="PUNCTUATION">)</p><p class="OPERATOR">!</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				try</p><p class="IDENTIFIER"> device</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">lockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
				if</p><p class="PUNCTUATION"> (</p><p class="IDENTIFIER">device</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">torchMode</p><p class="OPERATOR"> ==</p><p class="IDENTIFIER"> AVCaptureTorchMode</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">on</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					device</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">torchMode</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureTorchMode</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">off</p><p class="KEYWORD">
					self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isCameraTorchOn</p><p class="OPERATOR"> =</p><p class="KEYWORD"> false</p><p class="PUNCTUATION">
				}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
					do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
						try</p><p class="IDENTIFIER"> device</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">setTorchModeOnWithLevel</p><p class="PUNCTUATION">(</p><p class="NUMBER">1.0</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
						self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isCameraTorchOn</p><p class="OPERATOR"> =</p><p class="KEYWORD"> true</p><p class="PUNCTUATION">
					}</p><p class="KEYWORD"> catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
						print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: \(error)&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
					}</p><p class="PUNCTUATION">
				}</p><p class="IDENTIFIER">
				device</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">unlockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD"> catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: \(error)&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Sets whether SwiftyCam should enable background audio from other applications or sources
</p><p class="KEYWORD">	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> setBackgroundAudioPreference</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="IDENTIFIER"> allowBackgroundAudio</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

        guard</p><p class="IDENTIFIER"> audioEnabled</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
            return</p><p class="PUNCTUATION">
        }</p><p class="KEYWORD">

		do</p><p class="PUNCTUATION">{</p><p class="KEYWORD">
			try</p><p class="IDENTIFIER"> AVAudioSession</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">sharedInstance</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">setCategory</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">AVAudioSessionCategoryPlayAndRecord</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER">
			                                                with</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> [</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">duckOthers</p><p class="PUNCTUATION">,</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">defaultToSpeaker</p><p class="PUNCTUATION">]</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

			session</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">automaticallyConfiguresApplicationAudioSession</p><p class="OPERATOR"> =</p><p class="KEYWORD"> false</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">
		catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Failed to set background audio preference&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">

		}</p><p class="PUNCTUATION">
	}</p><p class="PUNCTUATION">
}</p><p class="KEYWORD">

extension</p><p class="IDENTIFIER"> SwiftyCamViewController</p><p class="PUNCTUATION"> :</p><p class="IDENTIFIER"> SwiftyCamButtonDelegate</p><p class="PUNCTUATION"> {</p><p class="COMMENT">

	/// Sets the maximum duration of the SwiftyCamButton
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> setMaxiumVideoDuration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="IDENTIFIER"> Double</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		return</p><p class="IDENTIFIER"> maximumVideoDuration</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Set UITapGesture to take photo
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> buttonWasTapped</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
		takePhoto</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Set UILongPressGesture start to begin video
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> buttonDidBeginLongPress</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
		startVideoRecording</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Set UILongPressGesture begin to begin end video
</p><p class="KEYWORD">
	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> buttonDidEndLongPress</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
		stopVideoRecording</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Called if maximum duration is reached
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> longPressDidReachMaximumDuration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
		stopVideoRecording</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="PUNCTUATION">
}</p><p class="COMMENT">

// MARK: AVCaptureFileOutputRecordingDelegate
</p><p class="KEYWORD">extension</p><p class="IDENTIFIER"> SwiftyCamViewController</p><p class="PUNCTUATION"> :</p><p class="IDENTIFIER"> AVCaptureFileOutputRecordingDelegate</p><p class="PUNCTUATION"> {</p><p class="COMMENT">

	/// Process newly captured video and write it to temporary directory
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> capture</p><p class="PUNCTUATION">(</p><p class="KEYWORD">_</p><p class="IDENTIFIER"> captureOutput</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> AVCaptureFileOutput</p><p class="OPERATOR">!</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didFinishRecordingToOutputFileAt</p><p class="IDENTIFIER"> outputFileURL</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> URL</p><p class="OPERATOR">!</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> fromConnections</p><p class="IDENTIFIER"> connections</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION"> [</p><p class="KEYWORD">Any</p><p class="PUNCTUATION">]</p><p class="OPERATOR">!</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> error</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> Error</p><p class="OPERATOR">!</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> currentBackgroundRecordingID</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> backgroundRecordingID</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			backgroundRecordingID</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIBackgroundTaskInvalid</p><p class="KEYWORD">

			if</p><p class="IDENTIFIER"> currentBackgroundRecordingID</p><p class="OPERATOR"> !=</p><p class="IDENTIFIER"> UIBackgroundTaskInvalid</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
				UIApplication</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">shared</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">endBackgroundTask</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">currentBackgroundRecordingID</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">
		if</p><p class="IDENTIFIER"> error</p><p class="OPERATOR"> !=</p><p class="KEYWORD"> nil</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Movie file finishing error: \(error)&quot;</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
            DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
                self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didFailToRecordVideo</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> error</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
            }</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
			//Call delegate function with the URL of the outputfile
</p><p class="IDENTIFIER">			DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didFinishProcessVideoAt</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> outputFileURL</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="PUNCTUATION">
}</p><p class="COMMENT">

// Mark: UIGestureRecognizer Declarations
</p><p class="KEYWORD">extension</p><p class="IDENTIFIER"> SwiftyCamViewController</p><p class="PUNCTUATION"> {</p><p class="COMMENT">

	/// Handle pinch gesture
</p><p class="PUNCTUATION">	@</p><p class="IDENTIFIER">objc</p><p class="KEYWORD"> fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> zoomGesture</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">pinch</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIPinchGestureRecognizer</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="IDENTIFIER"> pinchToZoom</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="OPERATOR"> &amp;&amp;</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
			//ignore pinch
</p><p class="KEYWORD">			return</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">
		do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			let</p><p class="IDENTIFIER"> captureDevice</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">devices</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">first</p><p class="KEYWORD"> as</p><p class="OPERATOR">?</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="KEYWORD">
			try</p><p class="IDENTIFIER"> captureDevice</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">lockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

			zoomScale</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> min</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">maxZoomScale</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> max</p><p class="PUNCTUATION">(</p><p class="NUMBER">1.0</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> min</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">beginZoomScale</p><p class="OPERATOR"> *</p><p class="IDENTIFIER"> pinch</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">scale</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER">  captureDevice</p><p class="OPERATOR">!.</p><p class="IDENTIFIER">activeFormat</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">videoMaxZoomFactor</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

			captureDevice</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">videoZoomFactor</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> zoomScale</p><p class="COMMENT">

			// Call Delegate function with current zoom scale
</p><p class="IDENTIFIER">			DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didChangeZoomLevel</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">zoomScale</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
			}</p><p class="IDENTIFIER">

			captureDevice</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">unlockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">

		}</p><p class="KEYWORD"> catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Error locking configuration&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Handle single tap gesture
</p><p class="PUNCTUATION">	@</p><p class="IDENTIFIER">objc</p><p class="KEYWORD"> fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> singleTapGesture</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">tap</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UITapGestureRecognizer</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="IDENTIFIER"> tapToFocus</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
			// Ignore taps
</p><p class="KEYWORD">			return</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">

		let</p><p class="IDENTIFIER"> screenSize</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> previewLayer</p><p class="OPERATOR">!.</p><p class="IDENTIFIER">bounds</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">size</p><p class="KEYWORD">
		let</p><p class="IDENTIFIER"> tapPoint</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> tap</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">location</p><p class="PUNCTUATION">(</p><p class="KEYWORD">in</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> previewLayer</p><p class="OPERATOR">!</p><p class="PUNCTUATION">)</p><p class="KEYWORD">
		let</p><p class="IDENTIFIER"> x</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> tapPoint</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">y</p><p class="OPERATOR"> /</p><p class="IDENTIFIER"> screenSize</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">height</p><p class="KEYWORD">
		let</p><p class="IDENTIFIER"> y</p><p class="OPERATOR"> =</p><p class="NUMBER"> 1.0</p><p class="OPERATOR"> -</p><p class="IDENTIFIER"> tapPoint</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">x</p><p class="OPERATOR"> /</p><p class="IDENTIFIER"> screenSize</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">width</p><p class="KEYWORD">
		let</p><p class="IDENTIFIER"> focusPoint</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> CGPoint</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">x</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> x</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> y</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> y</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

		if</p><p class="KEYWORD"> let</p><p class="IDENTIFIER"> device</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> videoDevice</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
				try</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">lockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

				if</p><p class="IDENTIFIER"> device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isFocusPointOfInterestSupported</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
					device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">focusPointOfInterest</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> focusPoint</p><p class="IDENTIFIER">
					device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">focusMode</p><p class="OPERATOR"> =</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">autoFocus</p><p class="PUNCTUATION">
				}</p><p class="IDENTIFIER">
				device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">exposurePointOfInterest</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> focusPoint</p><p class="IDENTIFIER">
				device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">exposureMode</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureExposureMode</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">continuousAutoExposure</p><p class="IDENTIFIER">
				device</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">unlockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="COMMENT">
				//Call delegate function and pass in the location of the touch
</p><p class="IDENTIFIER">				DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
					self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didFocusAtPoint</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> tapPoint</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
				}</p><p class="PUNCTUATION">
			}</p><p class="KEYWORD">
			catch</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
				// just ignore
</p><p class="PUNCTUATION">			}</p><p class="PUNCTUATION">
		}</p><p class="PUNCTUATION">
	}</p><p class="COMMENT">

	/// Handle double tap gesture
</p><p class="PUNCTUATION">	@</p><p class="IDENTIFIER">objc</p><p class="KEYWORD"> fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> doubleTapGesture</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">tap</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UITapGestureRecognizer</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		guard</p><p class="IDENTIFIER"> doubleTapCameraSwitch</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
			return</p><p class="PUNCTUATION">
		}</p><p class="IDENTIFIER">
		switchCamera</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="PUNCTUATION">

    @</p><p class="IDENTIFIER">objc</p><p class="KEYWORD"> private</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> panGesture</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">pan</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIPanGestureRecognizer</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">

        guard</p><p class="IDENTIFIER"> swipeToZoom</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="OPERATOR"> &amp;&amp;</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">currentCamera</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">rear</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="COMMENT">
            //ignore pan
</p><p class="KEYWORD">            return</p><p class="PUNCTUATION">
        }</p><p class="KEYWORD">
        let</p><p class="IDENTIFIER"> currentTranslation</p><p class="OPERATOR">    =</p><p class="IDENTIFIER"> pan</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">translation</p><p class="PUNCTUATION">(</p><p class="KEYWORD">in</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> view</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">y</p><p class="KEYWORD">
        let</p><p class="IDENTIFIER"> translationDifference</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> currentTranslation</p><p class="OPERATOR"> -</p><p class="IDENTIFIER"> previousPanTranslation</p><p class="KEYWORD">

        do</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
            let</p><p class="IDENTIFIER"> captureDevice</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">devices</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">first</p><p class="KEYWORD"> as</p><p class="OPERATOR">?</p><p class="IDENTIFIER"> AVCaptureDevice</p><p class="KEYWORD">
            try</p><p class="IDENTIFIER"> captureDevice</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">lockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

            let</p><p class="IDENTIFIER"> currentZoom</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> captureDevice</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">videoZoomFactor</p><p class="OPERATOR"> ??</p><p class="NUMBER"> 0.0</p><p class="KEYWORD">

            if</p><p class="IDENTIFIER"> swipeToZoomInverted</p><p class="OPERATOR"> ==</p><p class="KEYWORD"> true</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
                zoomScale</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> min</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">maxZoomScale</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> max</p><p class="PUNCTUATION">(</p><p class="NUMBER">1.0</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> min</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">currentZoom</p><p class="OPERATOR"> -</p><p class="PUNCTUATION"> (</p><p class="IDENTIFIER">translationDifference</p><p class="OPERATOR"> /</p><p class="NUMBER"> 75</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER">  captureDevice</p><p class="OPERATOR">!.</p><p class="IDENTIFIER">activeFormat</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">videoMaxZoomFactor</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
            }</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
                zoomScale</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> min</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">maxZoomScale</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> max</p><p class="PUNCTUATION">(</p><p class="NUMBER">1.0</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> min</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">currentZoom</p><p class="OPERATOR"> +</p><p class="PUNCTUATION"> (</p><p class="IDENTIFIER">translationDifference</p><p class="OPERATOR"> /</p><p class="NUMBER"> 75</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER">  captureDevice</p><p class="OPERATOR">!.</p><p class="IDENTIFIER">activeFormat</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">videoMaxZoomFactor</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">

            }</p><p class="IDENTIFIER">

            captureDevice</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">videoZoomFactor</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> zoomScale</p><p class="COMMENT">

            // Call Delegate function with current zoom scale
</p><p class="IDENTIFIER">            DispatchQueue</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">main</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">async</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
                self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">cameraDelegate</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">swiftyCam</p><p class="PUNCTUATION">(</p><p class="KEYWORD">self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> didChangeZoomLevel</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">zoomScale</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
            }</p><p class="IDENTIFIER">

            captureDevice</p><p class="OPERATOR">?.</p><p class="IDENTIFIER">unlockForConfiguration</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">

        }</p><p class="KEYWORD"> catch</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
            print</p><p class="PUNCTUATION">(</p><p class="LITERAL">&quot;[SwiftyCam]: Error locking configuration&quot;</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
        }</p><p class="KEYWORD">

        if</p><p class="IDENTIFIER"> pan</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">state</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">ended</p><p class="OPERATOR"> ||</p><p class="IDENTIFIER"> pan</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">state</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">failed</p><p class="OPERATOR"> ||</p><p class="IDENTIFIER"> pan</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">state</p><p class="OPERATOR"> ==</p><p class="PUNCTUATION"> .</p><p class="IDENTIFIER">cancelled</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
            previousPanTranslation</p><p class="OPERATOR"> =</p><p class="NUMBER"> 0.0</p><p class="PUNCTUATION">
        }</p><p class="KEYWORD"> else</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
            previousPanTranslation</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> currentTranslation</p><p class="PUNCTUATION">
        }</p><p class="PUNCTUATION">
    }</p><p class="COMMENT">

	/**
	Add pinch gesture recognizer and double tap gesture recognizer to currentView
	- Parameter view: View to add gesture recognzier
	*/</p><p class="KEYWORD">

	fileprivate</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> addGestureRecognizers</p><p class="PUNCTUATION">(</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
		pinchGesture</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIPinchGestureRecognizer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">target</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> action</p><p class="PUNCTUATION">:</p><p class="DIRECTIVE"> #selector</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">zoomGesture</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">pinch</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		pinchGesture</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">delegate</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="IDENTIFIER">
		previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addGestureRecognizer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">pinchGesture</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

		let</p><p class="IDENTIFIER"> singleTapGesture</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UITapGestureRecognizer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">target</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> action</p><p class="PUNCTUATION">:</p><p class="DIRECTIVE"> #selector</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">singleTapGesture</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">tap</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		singleTapGesture</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">numberOfTapsRequired</p><p class="OPERATOR"> =</p><p class="NUMBER"> 1</p><p class="IDENTIFIER">
		singleTapGesture</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">delegate</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="IDENTIFIER">
		previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addGestureRecognizer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">singleTapGesture</p><p class="PUNCTUATION">)</p><p class="KEYWORD">

		let</p><p class="IDENTIFIER"> doubleTapGesture</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UITapGestureRecognizer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">target</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> action</p><p class="PUNCTUATION">:</p><p class="DIRECTIVE"> #selector</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">doubleTapGesture</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">tap</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
		doubleTapGesture</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">numberOfTapsRequired</p><p class="OPERATOR"> =</p><p class="NUMBER"> 2</p><p class="IDENTIFIER">
		doubleTapGesture</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">delegate</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="IDENTIFIER">
		previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addGestureRecognizer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">doubleTapGesture</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">

        panGesture</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> UIPanGestureRecognizer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">target</p><p class="PUNCTUATION">:</p><p class="KEYWORD"> self</p><p class="PUNCTUATION">,</p><p class="IDENTIFIER"> action</p><p class="PUNCTUATION">:</p><p class="DIRECTIVE"> #selector</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">panGesture</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">pan</p><p class="PUNCTUATION">:</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">)</p><p class="IDENTIFIER">
        panGesture</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">delegate</p><p class="OPERATOR"> =</p><p class="KEYWORD"> self</p><p class="IDENTIFIER">
        previewLayer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">addGestureRecognizer</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">panGesture</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION">
	}</p><p class="PUNCTUATION">
}</p><p class="COMMENT">


// MARK: UIGestureRecognizerDelegate
</p><p class="KEYWORD">extension</p><p class="IDENTIFIER"> SwiftyCamViewController</p><p class="PUNCTUATION"> :</p><p class="IDENTIFIER"> UIGestureRecognizerDelegate</p><p class="PUNCTUATION"> {</p><p class="COMMENT">

	/// Set beginZoomScale when pinch begins
</p><p class="KEYWORD">	public</p><p class="KEYWORD"> func</p><p class="IDENTIFIER"> gestureRecognizerShouldBegin</p><p class="PUNCTUATION">(</p><p class="KEYWORD">_</p><p class="IDENTIFIER"> gestureRecognizer</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIGestureRecognizer</p><p class="PUNCTUATION">)</p><p class="OPERATOR"> -&gt;</p><p class="IDENTIFIER"> Bool</p><p class="PUNCTUATION"> {</p><p class="KEYWORD">
		if</p><p class="IDENTIFIER"> gestureRecognizer</p><p class="PUNCTUATION">.</p><p class="IDENTIFIER">isKind</p><p class="PUNCTUATION">(</p><p class="IDENTIFIER">of</p><p class="PUNCTUATION">:</p><p class="IDENTIFIER"> UIPinchGestureRecognizer</p><p class="PUNCTUATION">.</p><p class="KEYWORD">self</p><p class="PUNCTUATION">)</p><p class="PUNCTUATION"> {</p><p class="IDENTIFIER">
			beginZoomScale</p><p class="OPERATOR"> =</p><p class="IDENTIFIER"> zoomScale</p><p class="PUNCTUATION">;</p><p class="PUNCTUATION">
		}</p><p class="KEYWORD">
		return</p><p class="KEYWORD"> true</p><p class="PUNCTUATION">
	}</p><p class="PUNCTUATION">
}</p><p class="EOF">eof</p></div></body></html>